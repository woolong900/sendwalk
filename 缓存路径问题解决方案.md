# ç¼“å­˜è·¯å¾„é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ”´ é”™è¯¯ä¿¡æ¯

```
Please provide a valid cache path
```

## ğŸ” é—®é¢˜åŸå› 

è¿™ä¸ªé”™è¯¯é€šå¸¸ç”±ä»¥ä¸‹åŸå› å¼•èµ·ï¼š

1. **ç¼“å­˜ç›®å½•ä¸å­˜åœ¨** - Laravel éœ€è¦çš„ç¼“å­˜ç›®å½•æœªåˆ›å»º
2. **æƒé™é—®é¢˜** - Web æœåŠ¡å™¨ç”¨æˆ·ï¼ˆwww-dataï¼‰æ— æ³•å†™å…¥ç¼“å­˜ç›®å½•
3. **é…ç½®ç¼“å­˜æŸå** - é…ç½®ç¼“å­˜æ–‡ä»¶æŸåæˆ–ä¸å®Œæ•´
4. **Redis è¿æ¥é—®é¢˜** - å¦‚æœä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜é©±åŠ¨ï¼ŒRedis æœåŠ¡æœªè¿è¡Œ

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨å¿«é€Ÿä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
cd /data/www/sendwalk
chmod +x fix-cache-paths.sh
sudo ./fix-cache-paths.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- åˆ›å»ºæ‰€æœ‰å¿…è¦çš„ç¼“å­˜ç›®å½•
- è®¾ç½®æ­£ç¡®çš„æƒé™
- æ¸…é™¤æ—§ç¼“å­˜
- é‡æ–°ç”Ÿæˆç¼“å­˜

### æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨ä¿®å¤

#### æ­¥éª¤ 1ï¼šåˆ›å»ºç¼“å­˜ç›®å½•

```bash
cd /data/www/sendwalk/backend

# åˆ›å»ºæ‰€æœ‰å¿…è¦çš„ç›®å½•
mkdir -p storage/framework/cache/data
mkdir -p storage/framework/sessions
mkdir -p storage/framework/views
mkdir -p storage/logs
mkdir -p bootstrap/cache
```

#### æ­¥éª¤ 2ï¼šè®¾ç½®æƒé™

```bash
# è®¾ç½®æ‰€æœ‰è€…ä¸º www-data
sudo chown -R www-data:www-data storage bootstrap/cache

# è®¾ç½®ç›®å½•æƒé™
sudo chmod -R 775 storage bootstrap/cache
```

#### æ­¥éª¤ 3ï¼šæ¸…é™¤å’Œé‡å»ºç¼“å­˜

```bash
cd /data/www/sendwalk/backend

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# é‡æ–°ç”Ÿæˆç¼“å­˜ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

#### æ­¥éª¤ 4ï¼šé‡å¯æœåŠ¡

```bash
# é‡å¯ PHP-FPM
sudo systemctl restart php8.3-fpm

# é‡å¯ Supervisor è¿›ç¨‹
sudo supervisorctl restart all
```

### æ–¹æ¡ˆ 3ï¼šæ£€æŸ¥ Redis è¿æ¥ï¼ˆå¦‚æœä½¿ç”¨ Redis ç¼“å­˜ï¼‰

å¦‚æœ `.env` ä¸­é…ç½®äº† `CACHE_DRIVER=redis`ï¼š

```bash
# æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œ
sudo systemctl status redis-server

# å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨ Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server

# æµ‹è¯• Redis è¿æ¥
redis-cli ping
# åº”è¯¥è¿”å› PONG

# æµ‹è¯• Laravel è¿æ¥ Redis
cd /data/www/sendwalk/backend
php artisan tinker
# åœ¨ tinker ä¸­è¿è¡Œ:
# Redis::connection()->ping()
# åº”è¯¥è¿”å› true
```

## ğŸ” éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥ç›®å½•ç»“æ„

```bash
cd /data/www/sendwalk/backend

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ç›®å½•
ls -la storage/framework/cache/
ls -la storage/framework/sessions/
ls -la storage/framework/views/
ls -la bootstrap/cache/
```

### 2. æ£€æŸ¥æƒé™

```bash
# æ‰€æœ‰è€…åº”è¯¥æ˜¯ www-dataï¼Œæƒé™åº”è¯¥æ˜¯ 775 æˆ– 755
ls -la storage/
ls -la bootstrap/cache/
```

é¢„æœŸè¾“å‡ºç¤ºä¾‹ï¼š
```
drwxrwxr-x 5 www-data www-data 4096 Dec 21 10:00 storage
drwxrwxr-x 2 www-data www-data 4096 Dec 21 10:00 cache
```

### 3. æµ‹è¯•åº”ç”¨

```bash
# è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl https://api.sendwalk.com/api/health

# åº”è¯¥è¿”å›æˆåŠŸå“åº”ï¼Œè€Œä¸æ˜¯é”™è¯¯
```

### 4. æŸ¥çœ‹ Laravel æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—
tail -50 /data/www/sendwalk/backend/storage/logs/laravel-$(date +%Y-%m-%d).log

# åº”è¯¥æ²¡æœ‰ç¼“å­˜ç›¸å…³çš„é”™è¯¯
```

## ğŸš¨ å¸¸è§ç›¸å…³é”™è¯¯

### é”™è¯¯ 1: "Permission denied"

**é—®é¢˜**: Web æœåŠ¡å™¨æ— æ³•å†™å…¥ç›®å½•

**è§£å†³æ–¹æ¡ˆ**:
```bash
sudo chown -R www-data:www-data /data/www/sendwalk/backend/storage
sudo chown -R www-data:www-data /data/www/sendwalk/backend/bootstrap/cache
sudo chmod -R 775 /data/www/sendwalk/backend/storage
sudo chmod -R 775 /data/www/sendwalk/backend/bootstrap/cache
```

### é”™è¯¯ 2: "Failed to clear cache"

**é—®é¢˜**: ç¼“å­˜æ¸…é™¤å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd /data/www/sendwalk/backend

# æ‰‹åŠ¨åˆ é™¤ç¼“å­˜æ–‡ä»¶
sudo rm -rf storage/framework/cache/*
sudo rm -rf bootstrap/cache/*.php

# ä¿ç•™ .gitignore æ–‡ä»¶
# é‡æ–°åˆ›å»ºç›®å½•ç»“æ„
mkdir -p storage/framework/cache/data
```

### é”™è¯¯ 3: "Connection refused" (Redis)

**é—®é¢˜**: æ— æ³•è¿æ¥ Redis

**è§£å†³æ–¹æ¡ˆ 1** - å¯åŠ¨ Redis:
```bash
sudo systemctl start redis-server
sudo systemctl enable redis-server
```

**è§£å†³æ–¹æ¡ˆ 2** - ä¸´æ—¶åˆ‡æ¢åˆ°æ–‡ä»¶ç¼“å­˜:
```bash
# ç¼–è¾‘ .env
nano /data/www/sendwalk/backend/.env

# ä¿®æ”¹ç¼“å­˜é©±åŠ¨
CACHE_DRIVER=file

# æ¸…é™¤é…ç½®ç¼“å­˜
php artisan config:clear
php artisan config:cache

# é‡å¯æœåŠ¡
sudo systemctl restart php8.3-fpm
```

## ğŸ“‹ é¢„é˜²æªæ–½

### åœ¨éƒ¨ç½²è„šæœ¬ä¸­æ·»åŠ ç›®å½•åˆ›å»º

`deploy.sh` å·²æ›´æ–°ï¼ŒåŒ…å«è‡ªåŠ¨åˆ›å»ºç¼“å­˜ç›®å½•çš„æ­¥éª¤ï¼š

```bash
# åˆ›å»ºç¼“å­˜ç›®å½•
mkdir -p storage/framework/cache/data
mkdir -p storage/framework/sessions
mkdir -p storage/framework/views
mkdir -p storage/logs
mkdir -p bootstrap/cache
```

### å®šæœŸæ£€æŸ¥æƒé™

æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼š

```bash
# ç¼–è¾‘ crontab
sudo crontab -e

# æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ£€æŸ¥æƒé™
0 2 * * * /usr/bin/find /data/www/sendwalk/backend/storage -type d -exec chmod 775 {} \;
0 2 * * * /usr/bin/find /data/www/sendwalk/backend/bootstrap/cache -type d -exec chmod 775 {} \;
```

### åœ¨ .gitignore ä¸­ä¿ç•™ç›®å½•ç»“æ„

ç¡®ä¿ Git ä»“åº“åŒ…å«ç›®å½•ç»“æ„ï¼ˆå¸¦ .gitignoreï¼‰ï¼š

```bash
# åœ¨ storage/framework/cache/ ç›®å½•ä¸‹
touch .gitignore

# .gitignore å†…å®¹:
*
!.gitignore
```

## ğŸ”§ ç›®å½•ç»“æ„å‚è€ƒ

Laravel éœ€è¦çš„å®Œæ•´ç¼“å­˜ç›®å½•ç»“æ„ï¼š

```
backend/
â”œâ”€â”€ bootstrap/
â”‚   â””â”€â”€ cache/              # åº”ç”¨ç¼“å­˜ï¼ˆå¿…éœ€ï¼‰
â”‚       â”œâ”€â”€ packages.php
â”‚       â”œâ”€â”€ services.php
â”‚       â””â”€â”€ .gitignore
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ .gitignore
â”‚   â”œâ”€â”€ framework/
â”‚   â”‚   â”œâ”€â”€ cache/          # ç¼“å­˜æ•°æ®ï¼ˆå¿…éœ€ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â””â”€â”€ .gitignore
â”‚   â”‚   â”œâ”€â”€ sessions/       # ä¼šè¯æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨æ–‡ä»¶ä¼šè¯ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ .gitignore
â”‚   â”‚   â”œâ”€â”€ testing/
â”‚   â”‚   â”‚   â””â”€â”€ .gitignore
â”‚   â”‚   â””â”€â”€ views/          # ç¼–è¯‘çš„è§†å›¾ï¼ˆå¿…éœ€ï¼‰
â”‚   â”‚       â””â”€â”€ .gitignore
â”‚   â””â”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”‚       â”œâ”€â”€ laravel-YYYY-MM-DD.log
â”‚       â””â”€â”€ .gitignore
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼š

1. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**:
   ```bash
   tail -100 /data/www/sendwalk/backend/storage/logs/laravel-$(date +%Y-%m-%d).log
   ```

2. **æŸ¥çœ‹ PHP-FPM æ—¥å¿—**:
   ```bash
   sudo tail -50 /var/log/php8.3-fpm.log
   ```

3. **æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—**:
   ```bash
   sudo tail -50 /var/log/nginx/sendwalk-api-error.log
   ```

4. **æ£€æŸ¥ PHP é…ç½®**:
   ```bash
   php -i | grep -E "error_log|open_basedir"
   ```

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

ä¿®å¤åç¡®è®¤ï¼š

- [ ] æ‰€æœ‰ç¼“å­˜ç›®å½•éƒ½å­˜åœ¨
- [ ] ç›®å½•æƒé™æ­£ç¡®ï¼ˆ775ï¼Œæ‰€æœ‰è€… www-dataï¼‰
- [ ] å¯ä»¥æˆåŠŸæ¸…é™¤ç¼“å­˜ï¼ˆ`php artisan cache:clear`ï¼‰
- [ ] å¯ä»¥æˆåŠŸç”Ÿæˆé…ç½®ç¼“å­˜ï¼ˆ`php artisan config:cache`ï¼‰
- [ ] API å¥åº·æ£€æŸ¥æ­£å¸¸ï¼ˆ`curl https://api.sendwalk.com/api/health`ï¼‰
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨ API
- [ ] æ²¡æœ‰æƒé™ç›¸å…³é”™è¯¯æ—¥å¿—

---

**é—®é¢˜è§£å†³äº†å—ï¼Ÿ** å¦‚æœè¿˜æœ‰ç–‘é—®ï¼Œè¯·æŸ¥çœ‹ Laravel æ—¥å¿—è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

