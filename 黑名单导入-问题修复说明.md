# é»‘åå•æ‰¹é‡å¯¼å…¥ - é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šäº†ä¸‰ä¸ªé—®é¢˜ï¼š

1. **è¿›åº¦æ¡è·³åŠ¨é—®é¢˜**ï¼šå¯¼å…¥å¼€å§‹åè¿›åº¦æ¡ä¼šå¾ˆå¿«è·³åˆ°100%ï¼Œç„¶åé‡æ–°å¼€å§‹æ…¢æ…¢è·³åŠ¨
2. **æ–°å¢æ•°å­—ä¸€ç›´æ˜¯0**ï¼šæ–°å¢æ•°å­—ä¸€ç›´æ˜¾ç¤º0ï¼Œä½†å·²å­˜åœ¨å’Œæ— æ•ˆçš„æ•°å­—æ­£å¸¸
3. **é‡å¤æŒ‰é’®**ï¼šå³ä¸‹è§’æœ‰ä¸¤ä¸ª"å¯¼å…¥ä¸­"çš„æŒ‰é’®

## ğŸ” é—®é¢˜åŸå› 

### é—®é¢˜ 1: è¿›åº¦æ¡è·³åŠ¨

**åŸå› **ï¼šæ··æ·†äº†ä¸¤ä¸ªä¸åŒçš„è¿›åº¦ï¼š
- **æ–‡ä»¶ä¸Šä¼ è¿›åº¦**ï¼ˆonUploadProgressï¼‰ï¼šæ–‡ä»¶ä»æµè§ˆå™¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œé€šå¸¸å¾ˆå¿«ï¼ˆå‡ ç§’ï¼‰
- **å¯¼å…¥å¤„ç†è¿›åº¦**ï¼ˆåå°é˜Ÿåˆ—å¤„ç†ï¼‰ï¼šæœåŠ¡å™¨å¤„ç†æ•°æ®ï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆå‡ åˆ†é’Ÿï¼‰

ä¹‹å‰ç”¨åŒä¸€ä¸ª `uploadProgress` å˜é‡è¡¨ç¤ºä¸¤ä¸ªè¿›åº¦ï¼Œå¯¼è‡´ï¼š
1. æ–‡ä»¶ä¸Šä¼ å¿«é€Ÿåˆ° 100%
2. ç„¶åè¢«åå°å¤„ç†è¿›åº¦ï¼ˆä» 0% å¼€å§‹ï¼‰è¦†ç›–
3. çœ‹èµ·æ¥åƒæ˜¯"è·³å›å»äº†"

### é—®é¢˜ 2: æ–°å¢æ•°å­—ä¸€ç›´æ˜¯0

**åŸå› **ï¼šå‰ç«¯è½®è¯¢æ—¶çš„æ¡ä»¶åˆ¤æ–­é”™è¯¯ï¼š

```typescript
// âŒ æ—§ä»£ç 
if (progress.status === 'processing' && (progress.added > 0 || progress.already_exists > 0 || progress.invalid > 0)) {
  setImportResult({...})
}
```

è¿™ä¸ªæ¡ä»¶è¦æ±‚ `added > 0` æ‰ä¼šæ›´æ–°ç»“æœã€‚ä½†å¦‚æœï¼š
- æ‰€æœ‰é‚®ç®±éƒ½å·²å­˜åœ¨ï¼ˆadded = 0ï¼‰
- æˆ–è€…å‰å‡ æ‰¹éƒ½æ˜¯é‡å¤çš„

å°±ä¸ä¼šæ›´æ–° UIï¼Œå¯¼è‡´ `added` ä¸€ç›´æ˜¾ç¤ºä¸º 0ã€‚

### é—®é¢˜ 3: é‡å¤æŒ‰é’®

**åŸå› **ï¼šå–æ¶ˆæŒ‰é’®çš„æ–‡æœ¬é€»è¾‘ï¼š

```typescript
// âŒ æ—§ä»£ç 
<Button disabled={isUploading}>
  {isUploading ? 'å¯¼å…¥ä¸­...' : 'å–æ¶ˆ'}
</Button>
```

å½“ `isUploading = true` æ—¶ï¼š
- æŒ‰é’®æ˜¾ç¤º"å¯¼å…¥ä¸­..."
- æäº¤æŒ‰é’®ä¹Ÿæ˜¾ç¤º"å¯¼å…¥ä¸­..."
- çœ‹èµ·æ¥æœ‰ä¸¤ä¸ª"å¯¼å…¥ä¸­"æŒ‰é’®

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1: åˆ†ç¦»ä¸¤ä¸ªè¿›åº¦æ¡

```typescript
// âœ… æ–°ä»£ç 
const [fileUploadProgress, setFileUploadProgress] = useState(0)  // æ–‡ä»¶ä¸Šä¼ è¿›åº¦
const [importProgress, setImportProgress] = useState(0)          // å¯¼å…¥å¤„ç†è¿›åº¦

// æ–‡ä»¶ä¸Šä¼ é˜¶æ®µ
{fileUploadProgress < 100 && (
  <div className="space-y-2">
    <div className="flex justify-between text-sm">
      <span>ä¸Šä¼ æ–‡ä»¶</span>
      <span>{fileUploadProgress}%</span>
    </div>
    <Progress value={fileUploadProgress} />
  </div>
)}

// å¯¼å…¥å¤„ç†é˜¶æ®µ
{fileUploadProgress === 100 && (
  <div className="space-y-2">
    <div className="flex justify-between text-sm">
      <span>å¤„ç†è¿›åº¦</span>
      <span>{importProgress}%</span>
    </div>
    <Progress value={importProgress} />
  </div>
)}
```

**æ•ˆæœ**ï¼š
1. å…ˆæ˜¾ç¤º"ä¸Šä¼ æ–‡ä»¶" 0% â†’ 100%ï¼ˆå¿«é€Ÿï¼‰
2. ç„¶ååˆ‡æ¢åˆ°"å¤„ç†è¿›åº¦" 0% â†’ 100%ï¼ˆæ…¢é€Ÿï¼‰
3. ä¸¤ä¸ªé˜¶æ®µæ¸…æ™°åˆ†ç¦»ï¼Œä¸ä¼šè·³åŠ¨

### ä¿®å¤ 2: å§‹ç»ˆæ›´æ–°ç»“æœ

```typescript
// âœ… æ–°ä»£ç  - ç§»é™¤æ¡ä»¶åˆ¤æ–­
if (progress.status === 'processing') {
  setImportResult({
    added: progress.added || 0,
    already_exists: progress.already_exists || 0,
    invalid: progress.invalid || 0,
    status: progress.status,
  })
}
```

**æ•ˆæœ**ï¼š
- æ— è®ºæ•°å­—æ˜¯å¦ä¸º 0ï¼Œéƒ½ä¼šæ›´æ–° UI
- ç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ°æ‰€æœ‰ç»Ÿè®¡æ•°å­—çš„å˜åŒ–
- å³ä½¿å…¨éƒ¨æ˜¯é‡å¤é‚®ç®±ï¼Œä¹Ÿèƒ½çœ‹åˆ° `already_exists` åœ¨å¢é•¿

### ä¿®å¤ 3: ç®€åŒ–æŒ‰é’®æ–‡æœ¬

```typescript
// âœ… æ–°ä»£ç 
<Button disabled={isUploading}>
  å–æ¶ˆ
</Button>

<Button type="submit" disabled={isUploading || !selectedFile}>
  {isUploading && <Loader2 className="w-4 h-4 mr-2 animate-spin" />}
  {isUploading ? 'å¯¼å…¥ä¸­...' : 'å¼€å§‹å¯¼å…¥'}
</Button>
```

**æ•ˆæœ**ï¼š
- å–æ¶ˆæŒ‰é’®å§‹ç»ˆæ˜¾ç¤º"å–æ¶ˆ"
- åªæœ‰æäº¤æŒ‰é’®æ˜¾ç¤º"å¯¼å…¥ä¸­..."
- ä¸ä¼šå‡ºç°ä¸¤ä¸ªç›¸åŒæ–‡æœ¬çš„æŒ‰é’®

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### è¿›åº¦æ˜¾ç¤º

**ä¿®å¤å‰**ï¼š
```
å¯¼å…¥è¿›åº¦: 100% â† æ–‡ä»¶ä¸Šä¼ å®Œæˆ
å¯¼å…¥è¿›åº¦: 5%  â† çªç„¶è·³å›ï¼Œç”¨æˆ·å›°æƒ‘
å¯¼å…¥è¿›åº¦: 10%
...
```

**ä¿®å¤å**ï¼š
```
ä¸Šä¼ æ–‡ä»¶: 0% â†’ 100%  â† ç¬¬ä¸€é˜¶æ®µ
å¤„ç†è¿›åº¦: 0% â†’ 100%  â† ç¬¬äºŒé˜¶æ®µ
```

### æ•°å­—æ˜¾ç¤º

**ä¿®å¤å‰**ï¼š
```
æ–°å¢: 0  â† ä¸€ç›´ä¸å˜
å·²å­˜åœ¨: 150
æ— æ•ˆ: 5
```

**ä¿®å¤å**ï¼š
```
æ–°å¢: 0  â† å®æ—¶æ›´æ–°
å·²å­˜åœ¨: 150  â† å®æ—¶æ›´æ–°
æ— æ•ˆ: 5  â† å®æ—¶æ›´æ–°
```

### æŒ‰é’®æ˜¾ç¤º

**ä¿®å¤å‰**ï¼š
```
[å¯¼å…¥ä¸­...] [å¯¼å…¥ä¸­...] â† ä¸¤ä¸ªç›¸åŒæŒ‰é’®
```

**ä¿®å¤å**ï¼š
```
[å–æ¶ˆ] [å¯¼å…¥ä¸­...] â† æ¸…æ™°æ˜ç¡®
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯ 1: å…¨æ–°é‚®ç®±

```bash
# ç”Ÿæˆ 1000 ä¸ªæ–°é‚®ç®±
for i in {1..1000}; do echo "new${i}@example.com"; done > test_new.txt
```

**é¢„æœŸ**ï¼š
- ä¸Šä¼ æ–‡ä»¶ï¼šå¿«é€Ÿåˆ° 100%
- å¤„ç†è¿›åº¦ï¼šå¹³æ»‘å¢é•¿
- æ–°å¢ï¼š1000ï¼Œå·²å­˜åœ¨ï¼š0ï¼Œæ— æ•ˆï¼š0

### æµ‹è¯•åœºæ™¯ 2: å…¨éƒ¨é‡å¤

```bash
# ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶å†æ¬¡ä¸Šä¼ 
```

**é¢„æœŸ**ï¼š
- ä¸Šä¼ æ–‡ä»¶ï¼šå¿«é€Ÿåˆ° 100%
- å¤„ç†è¿›åº¦ï¼šå¹³æ»‘å¢é•¿
- æ–°å¢ï¼š0ï¼Œå·²å­˜åœ¨ï¼š1000ï¼Œæ— æ•ˆï¼š0 âœ… å…³é”®ï¼šæ–°å¢æ˜¾ç¤º 0

### æµ‹è¯•åœºæ™¯ 3: æ··åˆæ•°æ®

```bash
cat > test_mixed.txt << EOF
new1@example.com
new2@example.com
existing@example.com
invalid-email
new3@example.com
EOF
```

**é¢„æœŸ**ï¼š
- æ–°å¢ï¼š3
- å·²å­˜åœ¨ï¼š1
- æ— æ•ˆï¼š1

### æµ‹è¯•åœºæ™¯ 4: å¤§æ–‡ä»¶

```bash
# ç”Ÿæˆ 10 ä¸‡æ¡
seq 1 100000 | awk '{print "test"$1"@example.com"}' > test_100k.txt
```

**é¢„æœŸ**ï¼š
- ä¸Šä¼ æ–‡ä»¶ï¼š5-10ç§’åˆ° 100%
- å¤„ç†è¿›åº¦ï¼š30-60ç§’å¹³æ»‘å¢é•¿
- æ•°å­—å®æ—¶æ›´æ–°
- æŒ‰é’®æ–‡æœ¬æ­£ç¡®

## ğŸ¯ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### æ”¹è¿› 1: æ¸…æ™°çš„é˜¶æ®µåˆ’åˆ†

ç”¨æˆ·ç°åœ¨èƒ½æ¸…æ¥šåœ°çŸ¥é“ï¼š
1. **ä¸Šä¼ é˜¶æ®µ**ï¼šæ–‡ä»¶æ­£åœ¨ä¼ è¾“åˆ°æœåŠ¡å™¨
2. **å¤„ç†é˜¶æ®µ**ï¼šæœåŠ¡å™¨æ­£åœ¨å¤„ç†æ•°æ®

### æ”¹è¿› 2: å®æ—¶åé¦ˆ

æ— è®ºä»€ä¹ˆæƒ…å†µï¼Œç”¨æˆ·éƒ½èƒ½çœ‹åˆ°ï¼š
- å®æ—¶çš„è¿›åº¦ç™¾åˆ†æ¯”
- å®æ—¶çš„ç»Ÿè®¡æ•°å­—
- æ˜ç¡®çš„çŠ¶æ€æç¤º

### æ”¹è¿› 3: é¿å…æ··æ·†

- ä¸ä¼šå‡ºç°è¿›åº¦æ¡"å€’é€€"çš„ç°è±¡
- ä¸ä¼šæœ‰ä¸¤ä¸ªç›¸åŒçš„æŒ‰é’®
- æ‰€æœ‰æ•°å­—éƒ½ä¼šå®æ—¶æ›´æ–°

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### çŠ¶æ€ç®¡ç†

```typescript
// ä¸‰ä¸ªç‹¬ç«‹çš„çŠ¶æ€
const [fileUploadProgress, setFileUploadProgress] = useState(0)  // 0-100
const [importProgress, setImportProgress] = useState(0)          // 0-100
const [isUploading, setIsUploading] = useState(false)            // true/false

// æ–‡ä»¶ä¸Šä¼ æ—¶
onUploadProgress: (progressEvent) => {
  const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)
  setFileUploadProgress(percentCompleted)
}

// åå°å¤„ç†æ—¶
const progress = response.data.data
setImportProgress(progress.progress)  // æ¥è‡ªæœåŠ¡å™¨
```

### æ¡ä»¶æ¸²æŸ“

```typescript
// é˜¶æ®µ 1: æ–‡ä»¶ä¸Šä¼ ä¸­
{fileUploadProgress < 100 && (
  <div>ä¸Šä¼ æ–‡ä»¶: {fileUploadProgress}%</div>
)}

// é˜¶æ®µ 2: æ•°æ®å¤„ç†ä¸­
{fileUploadProgress === 100 && (
  <div>å¤„ç†è¿›åº¦: {importProgress}%</div>
)}

// é˜¶æ®µ 3: å®Œæˆ
{importResult?.status === 'completed' && !isUploading && (
  <div>å¯¼å…¥å®Œæˆï¼</div>
)}
```

### è½®è¯¢é€»è¾‘

```typescript
const pollImportProgress = (importId: string) => {
  const pollInterval = setInterval(async () => {
    const response = await api.get(`/blacklist/import-progress/${importId}`)
    const progress = response.data.data
    
    // æ›´æ–°è¿›åº¦
    setImportProgress(progress.progress)
    
    // å§‹ç»ˆæ›´æ–°ç»“æœï¼ˆä¸åˆ¤æ–­æ˜¯å¦ä¸º0ï¼‰
    setImportResult({
      added: progress.added || 0,
      already_exists: progress.already_exists || 0,
      invalid: progress.invalid || 0,
      status: progress.status,
    })
    
    // æ£€æŸ¥å®Œæˆ
    if (progress.status === 'completed') {
      clearInterval(pollInterval)
      setIsUploading(false)
    }
  }, 1000)
}
```

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²åéªŒè¯ä»¥ä¸‹åœºæ™¯ï¼š

- [ ] æ–‡ä»¶ä¸Šä¼ è¿›åº¦å¹³æ»‘ï¼ˆ0% â†’ 100%ï¼‰
- [ ] åˆ‡æ¢åˆ°å¤„ç†è¿›åº¦åä¸ä¼šè·³å›
- [ ] æ–°å¢æ•°å­—æ­£å¸¸æ›´æ–°ï¼ˆåŒ…æ‹¬ä¸º0çš„æƒ…å†µï¼‰
- [ ] å·²å­˜åœ¨æ•°å­—æ­£å¸¸æ›´æ–°
- [ ] æ— æ•ˆæ•°å­—æ­£å¸¸æ›´æ–°
- [ ] åªæœ‰ä¸€ä¸ª"å¯¼å…¥ä¸­..."æŒ‰é’®
- [ ] å–æ¶ˆæŒ‰é’®å§‹ç»ˆæ˜¾ç¤º"å–æ¶ˆ"
- [ ] å¯¼å…¥å®Œæˆåè‡ªåŠ¨å…³é—­

## ğŸš€ éƒ¨ç½²

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
cd /data/www/sendwalk
git pull

# 2. é‡æ–°æ„å»ºå‰ç«¯
cd frontend
npm run build

# 3. æµ‹è¯•
# åœ¨ç½‘é¡µä¸Šä¼ æµ‹è¯•æ–‡ä»¶ï¼ŒéªŒè¯ä»¥ä¸Šæ‰€æœ‰åœºæ™¯
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡ä¸Šä¼ é»‘åå•                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©æ–‡ä»¶: test.txt (1.5 MB)        â”‚
â”‚                                     â”‚
â”‚ ä¸Šä¼ æ–‡ä»¶: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%        â”‚  â† ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿ
â”‚                                     â”‚
â”‚ å¤„ç†è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35%         â”‚  â† ç¬¬äºŒé˜¶æ®µï¼šæ…¢é€Ÿ
â”‚                                     â”‚
â”‚ æ–°å¢: 1250                          â”‚  â† å®æ—¶æ›´æ–°
â”‚ å·²å­˜åœ¨: 350                         â”‚  â† å®æ—¶æ›´æ–°
â”‚ æ— æ•ˆ: 15                            â”‚  â† å®æ—¶æ›´æ–°
â”‚                                     â”‚
â”‚          [å–æ¶ˆ]  [å¯¼å…¥ä¸­...]        â”‚  â† æ¸…æ™°çš„æŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å®Œç¾çš„ç”¨æˆ·ä½“éªŒï¼ğŸ‰

