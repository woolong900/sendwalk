#!/bin/bash

# 修复邮件列表订阅者数量脚本
# 用于解决列表页面显示订阅者数量为0但详情页正确的问题

echo "=========================================="
echo "  修复邮件列表订阅者数量"
echo "=========================================="
echo ""

# 检查是否在项目根目录
if [ ! -d "backend" ]; then
    echo "❌ 错误: 请在项目根目录执行此脚本"
    exit 1
fi

cd backend

echo "正在重新计算所有邮件列表的订阅者数量..."
echo ""

php artisan lists:recalculate-counts

if [ $? -eq 0 ]; then
    echo ""
    echo "=========================================="
    echo "  ✅ 修复完成！"
    echo "=========================================="
    echo ""
    echo "请刷新浏览器页面查看更新后的数量"
else
    echo ""
    echo "=========================================="
    echo "  ❌ 修复失败"
    echo "=========================================="
    echo ""
    echo "请检查错误日志:"
    echo "  tail -f storage/logs/laravel.log"
fi

