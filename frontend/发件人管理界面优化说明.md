# 📧 发件人管理界面优化

## ✅ 已完成

SMTP 服务器编辑页面的发件人邮箱管理界面已优化，现在可以更直观地管理每个发件人的状态。

---

## 🎯 新界面特性

### 1. 单行输入框显示每个发件人

```
之前：
┌─────────────────────────────────┐
│ sender1@example.com             │
│ sender2@example.com             │
│ sender3@example.com             │
└─────────────────────────────────┘
(多行文本框，不显示状态)

现在：
┌─────────────────────────────────────────┐
│ sender1@example.com  [✓] [删除]         │
│ sender2@example.com  [▶] [删除]         │  ← 暂停中 (3分钟)
│ sender3@example.com  [✓] [删除]         │
└─────────────────────────────────────────┘
(每个发件人独立一行，显示状态和操作按钮)
```

### 2. 实时显示暂停状态

- ✅ **正常状态**：显示绿色 ✓ 图标
- ⏸️ **暂停状态**：显示 ▶ (恢复) 按钮 + 剩余时间
- 🔄 **一键恢复**：点击 ▶ 按钮即可恢复发件人

### 3. 便捷的添加/删除操作

- **添加**：底部输入框 + "添加"按钮
- **删除**：每行右侧的删除按钮
- **验证**：自动验证邮箱格式，防止重复添加

---

## 📊 界面截图示例

```
┌─ 发件人邮箱管理 ─────────────────────────────────┐
│ (可选，配置多个发件人轮换使用)                      │
│                                                    │
│ ┌────────────────────────────────────────────┐   │
│ │ sender1@example.com         [✓] [删除]     │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ┌────────────────────────────────────────────┐   │
│ │ sender2@example.com 暂停中(3分钟) [▶] [删除]│   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ┌────────────────────────────────────────────┐   │
│ │ sender3@example.com         [✓] [删除]     │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ┌─────────────────────────────────┬─────────┐   │
│ │ 添加发件人邮箱...                │ [添加]   │   │
│ └─────────────────────────────────┴─────────┘   │
│                                                    │
│ 💡 提示：配置多个发件人可以轮换使用，提高发送量    │
└────────────────────────────────────────────────┘
```

---

## 🔧 功能说明

### 1. 查看发件人状态

编辑 SMTP 服务器时，系统会自动获取每个发件人的暂停状态：

- **正常**：显示绿色 ✓ 图标
- **暂停中**：显示剩余暂停时间（如：暂停中 (3分钟)）

### 2. 恢复被暂停的发件人

点击暂停发件人右侧的 ▶ (Play) 按钮，即可立即恢复该发件人。

**注意：** 暂停功能由系统自动触发（检测到频率限制错误时），不支持手动暂停。

### 3. 添加新发件人

1. 在底部输入框输入邮箱地址
2. 点击"添加"按钮或按 Enter 键
3. 系统会自动验证邮箱格式和重复性

### 4. 删除发件人

点击每行右侧的删除按钮即可删除该发件人。

---

## 💡 使用场景

### 场景 1：配置多个发件人

```
SMTP 服务器：Gmail SMTP
发件人列表：
  - sender1@example.com  [✓]
  - sender2@example.com  [✓]
  - sender3@example.com  [✓]

系统会自动轮换使用这些发件人，提高发送量。
```

### 场景 2：某个发件人被暂停

```
SMTP 服务器：Gmail SMTP
发件人列表：
  - sender1@example.com  [✓]
  - sender2@example.com  [▶] 暂停中 (3分钟)  ← 触发频率限制
  - sender3@example.com  [✓]

操作：
1. 点击 sender2 的 ▶ 按钮可以立即恢复
2. 或等待 3 分钟自动恢复
3. sender1 和 sender3 继续正常使用
```

---

## 🎨 UI 组件

### 状态图标

- **✓ (Check)** - 绿色，表示发件人正常
- **▶ (Play)** - 蓝色按钮，点击恢复暂停的发件人
- **🗑️ (Trash)** - 红色，删除发件人

### 颜色方案

- **正常状态**：绿色 (#10b981)
- **暂停状态**：琥珀色 (#f59e0b)
- **删除按钮**：红色 (#ef4444)
- **恢复按钮**：蓝色 (primary)

---

## 🔄 数据流

### 1. 加载数据

```
编辑服务器
  ↓
解析 sender_emails (换行符分隔)
  ↓
获取 rate_limit_status.paused_senders
  ↓
显示每个发件人的状态
```

### 2. 保存数据

```
用户添加/删除发件人
  ↓
更新 senderEmails 数组
  ↓
提交时转换为换行符分隔的字符串
  ↓
保存到服务器
```

### 3. 恢复发件人

```
点击恢复按钮
  ↓
调用 API: POST /smtp-servers/{id}/resume-sender
  ↓
刷新服务器列表
  ↓
更新暂停状态
```

---

## 📝 修改的文件

1. ✅ `frontend/src/pages/settings/index.tsx`
   - 新增 `senderEmails` 状态管理发件人列表
   - 新增 `pausedSenders` 状态管理暂停信息
   - 新增 `handleAddSender()` - 添加发件人
   - 新增 `handleRemoveSender()` - 删除发件人
   - 新增 `handleToggleSender()` - 恢复发件人
   - 新增 `resumeSenderMutation` - 恢复 API 调用
   - 更新 SMTP 和 SES 表单渲染，使用新的 UI 组件
   - 添加 SES 发件人验证（至少一个发件人）

---

## ✨ 优势对比

### 旧界面

- ❌ 多行文本框，难以管理
- ❌ 无法看到每个发件人的状态
- ❌ 无法单独操作某个发件人
- ❌ 不知道哪个发件人被暂停

### 新界面

- ✅ 单行输入框，清晰明了
- ✅ 实时显示每个发件人的状态
- ✅ 可以单独恢复/删除发件人
- ✅ 一目了然地看到暂停状态和剩余时间

---

## 🆘 常见问题

### Q1: 为什么没有"暂停"按钮？

**A:** 暂停功能由系统自动触发。当检测到 "Excessive message rate" 等频率限制错误时，系统会自动暂停该发件人 5 分钟。这样可以保护您的 SMTP 账号不被封禁。

### Q2: 如何手动暂停发件人？

**A:** 目前不支持手动暂停。如果需要停止使用某个发件人，可以直接删除它。

### Q3: 恢复后会立即生效吗？

**A:** 是的，点击恢复按钮后，该发件人会立即可用。

### Q4: 可以添加多少个发件人？

**A:** 理论上没有限制，但建议配置 2-5 个发件人即可满足大多数需求。

---

## 🎯 总结

新的发件人管理界面提供了：

1. ✅ **可视化管理** - 每个发件人独立显示
2. ✅ **状态监控** - 实时显示暂停状态和剩余时间
3. ✅ **快速操作** - 一键添加/删除/恢复
4. ✅ **用户友好** - 清晰的 UI 和提示信息
5. ✅ **统一体验** - SMTP 和 SES 服务器使用相同的界面

## 📊 服务器类型差异

### SMTP 服务器
- 发件人邮箱：**可选**
- 提示：配置多个发件人可以轮换使用，提高发送量

### SES 服务器  
- 发件人邮箱：**必填**（至少一个）
- 提示：必须是在 AWS SES 中已验证的邮箱地址或域名
- 额外验证：提交时检查至少有一个发件人

---

**界面已优化完成！** 🎉

现在您可以更方便地管理 SMTP 和 SES 服务器的发件人邮箱了。

