# ğŸ§ª é»‘åå•å¯¼å…¥åŠŸèƒ½æµ‹è¯•æŒ‡å—

## å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### 1. ç¡®è®¤ç¯å¢ƒ

```bash
# æ£€æŸ¥ Redis
redis-cli ping
# åº”è¯¥è¿”å›: PONG

# æ£€æŸ¥é˜Ÿåˆ—è¿›ç¨‹
ps aux | grep "queue:work"
# åº”è¯¥çœ‹åˆ°é˜Ÿåˆ—è¿›ç¨‹æ­£åœ¨è¿è¡Œ
```

### 2. æµ‹è¯•å°æ‰¹é‡å¯¼å…¥ï¼ˆåŒæ­¥ï¼‰

åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼š
```bash
cat > /tmp/test_small.txt << 'EOF'
test1@example.com
test2@example.com
test3@example.com
test4@example.com
test5@example.com
EOF
```

**é¢„æœŸç»“æœ**ï¼š
- ç«‹å³è¿”å›ç»“æœ
- æ˜¾ç¤º"æ‰¹é‡ä¸Šä¼ å®Œæˆ"
- æ— è¿›åº¦æ¡

### 3. æµ‹è¯•å¤§æ‰¹é‡å¯¼å…¥ï¼ˆå¼‚æ­¥ï¼‰

åˆ›å»ºå¤§é‡æµ‹è¯•æ•°æ®ï¼š
```bash
# ç”Ÿæˆ15000ä¸ªæµ‹è¯•é‚®ç®±
for i in {1..15000}; do echo "test${i}@example.com"; done > /tmp/test_large.txt

# æŸ¥çœ‹æ–‡ä»¶å¤§å°
wc -l /tmp/test_large.txt
# åº”è¯¥æ˜¾ç¤º: 15000
```

**é¢„æœŸç»“æœ**ï¼š
- ç«‹å³è¿”å› task_id
- æ˜¾ç¤º"å¤§æ‰¹é‡å¯¼å…¥å·²æäº¤"
- æ‰“å¼€è¿›åº¦æ¡Dialog
- è¿›åº¦æ¡å®æ—¶æ›´æ–°
- å®Œæˆåæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯

### 4. ç›‘æ§å¯¼å…¥è¿‡ç¨‹

**æŸ¥çœ‹é˜Ÿåˆ—ä»»åŠ¡æ•°**ï¼š
```bash
redis-cli LLEN queues:default
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
# å®æ—¶æŸ¥çœ‹é˜Ÿåˆ—æ—¥å¿—
tail -f storage/logs/queue.log

# æœç´¢å¯¼å…¥æ—¥å¿—
grep "é»‘åå•å¯¼å…¥" storage/logs/laravel.log
```

**æŸ¥çœ‹è¿›åº¦ç¼“å­˜**ï¼š
```bash
# åˆ—å‡ºæ‰€æœ‰å¯¼å…¥ä»»åŠ¡
redis-cli KEYS "blacklist_import_*"

# æŸ¥çœ‹å…·ä½“ä»»åŠ¡è¿›åº¦
redis-cli GET "blacklist_import_YOUR_TASK_ID"
```

### 5. å‰ç«¯æ“ä½œæ­¥éª¤

1. **æ‰“å¼€é»‘åå•é¡µé¢**
   - è®¿é—®ï¼šhttps://edm.sendwalk.com/blacklist

2. **ç‚¹å‡»"æ‰¹é‡ä¸Šä¼ "æŒ‰é’®**

3. **é€‰æ‹©æµ‹è¯•æ–‡ä»¶**
   - å°æ–‡ä»¶ (< 10,000æ¡): `/tmp/test_small.txt`
   - å¤§æ–‡ä»¶ (> 10,000æ¡): `/tmp/test_large.txt`

4. **è§‚å¯Ÿç»“æœ**
   - å°æ‰¹é‡ï¼šç›´æ¥æ˜¾ç¤ºç»“æœtoast
   - å¤§æ‰¹é‡ï¼šæ‰“å¼€è¿›åº¦æ¡Dialogï¼Œæ˜¾ç¤ºå®æ—¶è¿›åº¦

### 6. éªŒè¯ç»“æœ

**æŸ¥çœ‹æ•°æ®åº“è®°å½•**ï¼š
```bash
cd /Users/panlei/sendwalk/backend
php artisan tinker
```

åœ¨ tinker ä¸­æ‰§è¡Œï¼š
```php
// æŸ¥çœ‹é»‘åå•æ€»æ•°
\App\Models\Blacklist::count();

// æŸ¥çœ‹æœ€è¿‘10æ¡
\App\Models\Blacklist::latest()->take(10)->get(['email', 'reason']);

// æŸ¥çœ‹å¯¼å…¥çš„æµ‹è¯•æ•°æ®æ•°é‡
\App\Models\Blacklist::where('email', 'like', 'test%@example.com')->count();
```

### 7. æ¸…ç†æµ‹è¯•æ•°æ®

```bash
cd /Users/panlei/sendwalk/backend
php artisan tinker
```

```php
// åˆ é™¤æ‰€æœ‰æµ‹è¯•é‚®ç®±
\App\Models\Blacklist::where('email', 'like', 'test%@example.com')->delete();
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šä¸Šä¼ åæ²¡æœ‰è¿›åº¦æ¡

**å¯èƒ½åŸå› **ï¼š
- æ–‡ä»¶å°äº 10,000 æ¡ï¼ˆä¼šåŒæ­¥å¤„ç†ï¼‰
- å‰ç«¯ä»£ç æœªæ›´æ–°

**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡æ–°æ„å»ºå‰ç«¯
cd /Users/panlei/sendwalk/frontend
npm run build

# é‡å¯ Nginx
sudo nginx -s reload
```

### é—®é¢˜2ï¼šè¿›åº¦ä¸€ç›´æ˜¯0%

**å¯èƒ½åŸå› **ï¼š
- é˜Ÿåˆ—æœªå¯åŠ¨
- Redis è¿æ¥é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥é˜Ÿåˆ—
ps aux | grep "queue:work"

# é‡å¯é˜Ÿåˆ—
php artisan queue:restart
php artisan queue:work --tries=3 --max-time=3600 &

# æ£€æŸ¥ Redis
redis-cli ping
```

### é—®é¢˜3ï¼šå¯¼å…¥å¤±è´¥

**æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š
```bash
tail -100 storage/logs/laravel.log | grep -A 20 "ERROR"
```

**å¸¸è§é”™è¯¯**ï¼š
1. **å†…å­˜ä¸è¶³**ï¼šå¢åŠ  PHP å†…å­˜é™åˆ¶
2. **è¶…æ—¶**ï¼šå¢åŠ  `max_execution_time`
3. **æ•°æ®åº“è¿æ¥**ï¼šæ£€æŸ¥ MySQL è¿æ¥

---

## æ€§èƒ½æµ‹è¯•

### æµ‹è¯•ä¸åŒæ•°æ®é‡

```bash
# 1ä¸‡æ¡
for i in {1..10000}; do echo "test${i}@example.com"; done > /tmp/test_10k.txt

# 10ä¸‡æ¡
for i in {1..100000}; do echo "test${i}@example.com"; done > /tmp/test_100k.txt

# 50ä¸‡æ¡
for i in {1..500000}; do echo "test${i}@example.com"; done > /tmp/test_500k.txt
```

### é¢„æœŸå¤„ç†æ—¶é—´

| æ•°æ®é‡ | é¢„æœŸæ—¶é—´ | æ‰¹æ¬¡æ•° |
|--------|----------|--------|
| 1ä¸‡æ¡ | 3-5ç§’ | 10 |
| 10ä¸‡æ¡ | 30ç§’ | 100 |
| 50ä¸‡æ¡ | 2-3åˆ†é’Ÿ | 500 |
| 100ä¸‡æ¡ | 5åˆ†é’Ÿ | 1000 |
| 200ä¸‡æ¡ | 10åˆ†é’Ÿ | 2000 |

---

## API æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨ curl æµ‹è¯•

**å°æ‰¹é‡å¯¼å…¥**ï¼š
```bash
curl -X POST https://api.sendwalk.com/api/blacklist/batch-upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "emails": "test1@example.com\ntest2@example.com\ntest3@example.com",
    "reason": "æµ‹è¯•å¯¼å…¥"
  }'
```

**æŸ¥è¯¢è¿›åº¦**ï¼š
```bash
curl -X GET https://api.sendwalk.com/api/blacklist/import-progress/TASK_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## æˆåŠŸæ ‡å‡†

âœ… **å°æ‰¹é‡å¯¼å…¥**ï¼š
- ç«‹å³è¿”å›ç»“æœ
- æ•°æ®æ­£ç¡®å…¥åº“
- æ˜¾ç¤ºå‡†ç¡®ç»Ÿè®¡

âœ… **å¤§æ‰¹é‡å¯¼å…¥**ï¼š
- è¿”å› task_id
- è¿›åº¦æ¡æ˜¾ç¤º
- å®æ—¶è¿›åº¦æ›´æ–°
- å®Œæˆåæ˜¾ç¤ºç»“æœ
- æ— å†…å­˜æº¢å‡º
- æ— è¶…æ—¶é”™è¯¯

âœ… **æ€§èƒ½**ï¼š
- 200ä¸‡æ¡åœ¨10åˆ†é’Ÿå†…å®Œæˆ
- å†…å­˜ä½¿ç”¨ç¨³å®š
- æ•°æ®å®Œæ•´æ€§

---

## ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥ï¼š
1. å¯¼å…¥çœŸå®çš„é»‘åå•æ•°æ®
2. é…ç½®å®šæœŸæ¸…ç†ä»»åŠ¡
3. è®¾ç½®ç›‘æ§å‘Šè­¦
4. ä¼˜åŒ–æ‰¹æ¬¡å¤§å°ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

