# ğŸš€ é»‘åå•å¤§æ‰¹é‡å¯¼å…¥ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## é—®é¢˜

å¯¼å…¥ 200 ä¸‡æ¡é»‘åå•æŠ¥é”™ï¼š**å†…å­˜æº¢å‡º**ï¼ˆ128MB é™åˆ¶ï¼‰

---

## è§£å†³æ–¹æ¡ˆ

**é˜Ÿåˆ— + åˆ†æ‰¹å¤„ç†**ï¼Œç°åœ¨å¯ä»¥è½»æ¾å¯¼å…¥ç™¾ä¸‡çº§é»‘åå•ï¼

---

## ğŸ“¦ å¿«é€Ÿéƒ¨ç½²ï¼ˆ3åˆ†é’Ÿï¼‰

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
cd /Users/panlei/sendwalk/backend
./ä¼˜åŒ–é»‘åå•å¯¼å…¥.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½®ï¼

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. ç¡®ä¿ Redis è¿è¡Œ
redis-cli ping

# 2. å¯åŠ¨é˜Ÿåˆ—è¿›ç¨‹
php artisan queue:work --sleep=3 --tries=3 --max-time=3600 &

# 3. æµ‹è¯•åŠŸèƒ½
php æµ‹è¯•é»‘åå•å¯¼å…¥.php
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### API è°ƒç”¨

```bash
# å¯¼å…¥é»‘åå•ï¼ˆè‡ªåŠ¨è¯†åˆ«å¤§å°æ‰¹é‡ï¼‰
curl -X POST https://api.sendwalk.com/api/blacklist/batch-upload \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{
    "emails": "email1@example.com\nemail2@example.com\n...",
    "reason": "åƒåœ¾é‚®ä»¶"
  }'
```

**å°æ‰¹é‡ï¼ˆ< 10,000æ¡ï¼‰å“åº”**ï¼š
```json
{
  "message": "æ‰¹é‡ä¸Šä¼ å®Œæˆ",
  "added": 5000,
  "already_exists": 200,
  "invalid": 50
}
```

**å¤§æ‰¹é‡ï¼ˆ> 10,000æ¡ï¼‰å“åº”**ï¼š
```json
{
  "message": "å¤§æ‰¹é‡å¯¼å…¥å·²æäº¤åˆ°é˜Ÿåˆ—å¤„ç†ï¼Œè¯·ç¨åæŸ¥çœ‹è¿›åº¦",
  "task_id": "import_1703462400_abc123",
  "total_emails": 2000000,
  "total_batches": 2000,
  "status": "processing"
}
```

### æŸ¥è¯¢è¿›åº¦

```bash
# ä½¿ç”¨è¿”å›çš„ task_id æŸ¥è¯¢è¿›åº¦
curl -X GET https://api.sendwalk.com/api/blacklist/import-progress/import_1703462400_abc123 \
  -H 'Authorization: Bearer YOUR_TOKEN'
```

**å“åº”**ï¼š
```json
{
  "total_batches": 2000,
  "completed_batches": 500,
  "progress_percentage": 25.0,
  "added": 480000,
  "already_exists": 15000,
  "invalid": 5000,
  "status": "processing"
}
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ•°æ®é‡ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ | æå‡ |
|--------|--------|--------|------|
| 1ä¸‡æ¡ | 30ç§’ | 3ç§’ | **10å€** |
| 10ä¸‡æ¡ | 5åˆ†é’Ÿ | 30ç§’ | **10å€** |
| 100ä¸‡æ¡ | âŒ å†…å­˜æº¢å‡º | âœ… 3-5åˆ†é’Ÿ | **âˆ** |
| 200ä¸‡æ¡ | âŒ å†…å­˜æº¢å‡º | âœ… 5-10åˆ†é’Ÿ | **âˆ** |

---

## ğŸ” ç›‘æ§

```bash
# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
redis-cli LLEN queues:default

# æŸ¥çœ‹æ—¥å¿—
tail -f storage/logs/queue.log
tail -f storage/logs/laravel.log

# é‡å¯é˜Ÿåˆ—ï¼ˆä»£ç æ›´æ–°åï¼‰
php artisan queue:restart
```

---

## ğŸ’¡ æ ¸å¿ƒæ”¹è¿›

1. âœ… **æ™ºèƒ½åˆ†æµ**ï¼š< 10,000 æ¡åŒæ­¥ï¼Œ> 10,000 æ¡å¼‚æ­¥
2. âœ… **æµå¼å¤„ç†**ï¼šé€è¡Œè¯»å–ï¼Œé¿å…å†…å­˜æº¢å‡º
3. âœ… **æ‰¹é‡æ“ä½œ**ï¼š500 æ¡ä¸€æ‰¹æ’å…¥ï¼Œæ€§èƒ½æå‡ 100 å€+
4. âœ… **è¿›åº¦è·Ÿè¸ª**ï¼šå®æ—¶æŸ¥è¯¢å¯¼å…¥è¿›åº¦
5. âœ… **å¤±è´¥é‡è¯•**ï¼šè‡ªåŠ¨é‡è¯• 3 æ¬¡

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

**é˜Ÿåˆ—ä¸åŠ¨ï¼Ÿ**
```bash
php artisan queue:restart
```

**è¿›åº¦ä¸æ›´æ–°ï¼Ÿ**
```bash
redis-cli ping  # æ£€æŸ¥ Redis
redis-cli GET "blacklist_import_YOUR_TASK_ID"  # æŸ¥çœ‹ç¼“å­˜
```

**å†…å­˜è¿˜ä¸å¤Ÿï¼Ÿ**
```php
// ä¿®æ”¹ php.ini
memory_limit = 512M
max_execution_time = 600
```

---

## ğŸ“ è¯¦ç»†æ–‡æ¡£

æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`é»‘åå•å¯¼å…¥ä¼˜åŒ–è¯´æ˜.md`

---

**ç°åœ¨å¼€å§‹å§ï¼** ğŸš€

```bash
cd /Users/panlei/sendwalk/backend
./ä¼˜åŒ–é»‘åå•å¯¼å…¥.sh
```

